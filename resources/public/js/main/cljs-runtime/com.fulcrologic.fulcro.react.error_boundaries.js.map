{"version":3,"sources":["com/fulcrologic/fulcro/react/error_boundaries.cljc"],"mappings":";AAUA;;;;AAAeA,yEAGb,iFAAKC,MAAKC;AAAV,AAAA;;AAEF,AAAA,GAAA,QAAAC,gCAAAC,4CAAAC,mDAAAC,yDAAAC,0EAAAC;AAAA;AAAA,AAAA,8DAAA,sEAAAC,pIAAO8B;AAAP,AAAA,IAAA7B,wBAAA,AAAA,wFAAA,CAAAC,oFAAAA,iJAAAA,/DAAO4B,6HAAAA;IAAP3B,aAAA,AAAAC,6CAAAJ,wBAAO8B;IAAPzB,sBAAA,AAAAC,4CAAAH,WAAA,IAAA;IAAAI,uBAAA,AAAAD,4CAAAH,WAAA,IAAA;AAAA,AAAA,QAAAF,sDAAAA,oDAAAI,oBAAAE,wBAAAN,gCAAAI,oBAAAE;;;;AAAA,AAAAC,qHAAA,2CAAA,kEAAA,KAAA,wEAAA,gKAAA,0DAAA,mFAAAC,niBAAOqB,6hBAGJtC;AAHH,AAAA,IAAAkB,aAAAD;IAAAC,iBAAA,AAAAC,4BAAAD;aAAA,AAAAE,4CAAAF,eAAA,pEAGgBqB;aAHhB,AAAAnB,4CAAAF,eAAA,pEAGuBsB;AAHvB,AAAA,OAAAnB,uDAAA,NAGGrB;AAHH,AAAA,IAAAsB,kCAAAC;IAAAC,qCAAAC;IAAAC,qCAAAC;IAAAC,kCAAA,iBAAAC,mBAAAN;AAAA,AAAA,oBAAAM;AAAAA;;AAAA,IAAAC,WAGG9B;IAHH+B,WAAA,mFAAA,QAAA;AAAA,AAAA,QAAAC,4EAAAA,0EAAAF,SAAAC,YAAAC,sDAAAF,SAAAC;;;IAAAE,qCAAA,AAAAC,uEAAA,iBAAAL,mBAAAN;AAAA,AAAA,oBAAAM;AAAAA;;AAAA,IAAAM,WAGGnC;IAHHoC,WAAA,mFAAA,QAAA;AAAA,AAAA,QAAAJ,4EAAAA,0EAAAG,SAAAC,YAAAJ,sDAAAG,SAAAC;;;IAAAC,qCAGGrC;AAHH,AAAA,CAAAuB,oDAAAK;;AAAA,CAAAH,uDAAAQ;;AAAA,CAAAN,uDAAAU;;AAAA,IAAA,AAAA,AAAA,AAKE,IAAAI,wBAA0B,iBAAAZ,mBAAIU;AAAJ,AAAA,oBAAAV;AAAAA;;AAAW7B;;;IAArC0C,qBAAA,iBAAAb,mBAAAN;AAAA,AAAA,oBAAAM;AAAAA;;AAAA,OAAAc,8CAAAF;;;IAAAG,mBAAA,AAAAV,uEAAAQ;IAAAG,mBAAA,iBAAAhB,mBAAAF;AAAA,AAAA,oBAAAE;AAAAA;;AAAAY;;;AAAA,AAAA,IAAAK,kCAAAvB;IAAAwB,qCAAAtB;IAAAuB,qCAAArB;IAAAsB,kCAAAP;IAAAQ,qCAAAN;IAAAO,qCAAAN;AAAA,AAAA,CAAAtB,oDAAA0B;;AAAA,CAAAxB,uDAAAyB;;AAAA,CAAAvB,uDAAAwB;;AAAA,IAAA,AACE,QAACX,uCAAAA,yCAAAA;UADH,AAAA,CAAAb,uDAAAqB;;AAAA,CAAAvB,uDAAAsB;;AAAA,CAAAxB,oDAAAuB;WALF,AAAA,CAAAnB,uDAAAD;;AAAA,CAAAD,uDAAAD;;AAAA,CAAAD,oDAAAD;;;AAQA,AAAK8B,kEAAkB,AAACC,wEAAaf;AAErC,AAAA,AAAA;AAAA,IAAAgB,+BAAA,2CAAA,uFAC6B,WAAKO,IAAIC;AAAT,AAAA;GAD7B,4FAE6B,WAAKC;AAAL,AAAA,kDAAA,uDAAA,KAAA,sDAEUA;GAJvC,8EAK6B,WAAKC,MAAMD,MAAME;AAAjB,AAAwB,OAAAC,0DAAAC,mCAAA,uDAAA,gDAAA,KAAA,GAAA,8CAAA,qDAAA,KAAAC,gBAAA;AAAA,AAAA,0FAAW,AAACC,qBAAWN;GAAvB,OAAA,KAAA,UAAA;GALrD,0DAAA,6EAAsB/D;AAAtB,AAAA,OAAAqB,uDAAA,NAAsBrB;AAAtB,AAAA,YAAA,CAAAuD,wEAAAA,+EAAAA,TAAsBvD,2DAAAA,lNAAK4D;AAA3B,AAME,IAAAU,aAA4B,AAACC,0EAAevE;IAA5CsE,iBAAA,AAAAnD,4BAAAmD;YAAA,AAAAlD,4CAAAkD,eAAA,nEAAcP;YAAd,AAAA3C,4CAAAkD,eAAA,nEAAoBrE;AAApB,AACE,oBAAI8D;AACF,OAAChE,iFAAeC,MAAKC;;AACrB,QAACmD,gGAAAA,uGAAAA,TAAkBQ,mFAAAA;;;;AATzB,AAAA,GAAA,QAAA1D,gCAAAC,4CAAAC,mDAAAC,yDAAAC,0EAAAkD;AAAA;AAAA,AAAA;;;8DAAA,AAAAC,oDAAA,AAAArC,4CAAAkC,6BAAA,3LAAOK;;;AAAP,AAAAD,wHAAA,gKAAAJ,5NAAOK;AAWP,AAAKa,kEAAkB,AAACnB,wEAAaM","names":["com.fulcrologic.fulcro.react.error-boundaries/*render-error*","this","cause","js/com","js/com.fulcrologic","js/com.fulcrologic.fulcro","js/com.fulcrologic.fulcro.react","js/com.fulcrologic.fulcro.react.error-boundaries","js/com.fulcrologic.fulcro.react.error-boundaries.BodyContainer","js-props__50841__auto__","render__50842__auto__","com.fulcrologic.fulcro.components/component-options","vec__91648","com.fulcrologic.fulcro.components/use-fulcro","this__50843__auto__","cljs.core.nth","props__50844__auto__","com.fulcrologic.fulcro.components/add-hook-options!","p__91651","map__91652","cljs.core/--destructure-map","cljs.core.get","com.fulcrologic.fulcro.components/wrapped-render","*app*-orig-val__91653","com.fulcrologic.fulcro.components/*app*","*shared*-orig-val__91654","com.fulcrologic.fulcro.components/*shared*","*parent*-orig-val__91655","com.fulcrologic.fulcro.components/*parent*","*app*-temp-val__91656","or__5045__auto__","G__91659","G__91660","com.fulcrologic.fulcro.components/isoget-in","*shared*-temp-val__91657","com.fulcrologic.fulcro.components.shared","G__91661","G__91662","*parent*-temp-val__91658","com.fulcrologic.fulcro.react.error-boundaries/BodyContainer","parent","render","parent__50736__auto__","app__50737__auto__","com.fulcrologic.fulcro.components/any->app","s__50738__auto__","p__50739__auto__","*app*-orig-val__91663","*shared*-orig-val__91664","*parent*-orig-val__91665","*app*-temp-val__91666","*shared*-temp-val__91667","*parent*-temp-val__91668","com.fulcrologic.fulcro.react.error-boundaries/ui-body-container","com.fulcrologic.fulcro.components.factory","options__50845__auto__","com.fulcrologic.fulcro.components/props","js/com.fulcrologic.fulcro.react.error-boundaries.ErrorBoundary","com.fulcrologic.fulcro.components/react-constructor","com.fulcrologic.fulcro.components/configure-component!","com.fulcrologic.fulcro.react.error-boundaries/ErrorBoundary","props","_np","_ns","error","_this","_info","taoensso.timbre._log_BANG_","taoensso.timbre/*config*","cljs.core/Delay","cljs.core/ex-message","map__91669","com.fulcrologic.fulcro.components.get_state","com.fulcrologic.fulcro.react.error-boundaries/ui-error-boundary"],"sourcesContent":["(ns com.fulcrologic.fulcro.react.error-boundaries\n  \"A macro and predefined component that can create a boundary above which errors cannot propagate. Read the docstring\n  of `error-boundary` carefully. Works with server-side rendering as well, and provides for development-time retries\n  to recover after a hot code reload without having to reload the entire page.\"\n  #?(:cljs (:require-macros com.fulcrologic.fulcro.react.error-boundaries))\n  (:require\n    [com.fulcrologic.fulcro.components :as comp :refer [defsc]]\n    [taoensso.encore :as enc]\n    [taoensso.timbre :as log]))\n\n(def ^:dynamic *render-error*\n  \"A `(fn [react-element exception] what-to-render)`. Called in order to render an alternate for UI segments that have crashed.\n   Defaults to a simple div containing the error header and message as standard HTML elements.\"\n  (fn [this cause] \"There was an error.\"))\n\n(defsc BodyContainer\n  \"A very lightweight container to offset errors so that we can use `error-boundary` to actually catch errors\n   from subsections of a UI.\"\n  [this {:keys [parent render]}]\n  {:use-hooks? true}\n  (comp/with-parent-context (or parent this)\n    (render)))\n\n(def ui-body-container (comp/factory BodyContainer))\n\n(defsc ErrorBoundary [this props]\n  {:shouldComponentUpdate    (fn [_np _ns] true)\n   :getDerivedStateFromError (fn [error]\n                               {:error true\n                                :cause error})\n   :componentDidCatch        (fn [_this error _info] (log/error (ex-message error)))}\n  (let [{:keys [error cause]} (comp/get-state this)]\n    (if error\n      (*render-error* this cause)\n      (ui-body-container props))))\n\n(def ui-error-boundary (comp/factory ErrorBoundary))\n\n#?(:clj\n   (defn error-boundary* [body]\n     `(ui-error-boundary {:parent comp/*parent*\n                          :render #(comp/fragment ~@body)})))\n\n#?(:clj\n   (defn error-boundary-clj [body]\n     `(try\n        ~@body\n        (catch Throwable _e# \"Error\"))))\n\n#?(:clj\n   (defmacro error-boundary\n     \"Wraps the given children in a nested pair of stateless elements that prevent unexpected exceptions from\n     propagating up the UI tree. Any unexpected rendering or lifecycle errors that happen will be\n     caught and cause an error message to be shown in place of the children.\n\n     The error boundary rendering is very very simple by default. A simple message that says there was an error. This\n     is partially because you will always probably want to customize it, and also so there are no dependencies on DOM\n     so that this macro is usable in Native, where there is no DOM.\n\n     You can clear an error with component local state (see example below), but unless the problem has been corrected\n     it will just fail again. Therefore, clearing the error is probably not useful except during development when a hot\n     code reload could actually fix the problem.\n\n     You can also completely take over the error boundary rendering by `binding` or by setting to root binding of *render-error*\n     via `set!` in cljs, and `alter-var-root` in Clojure.\n\n     For example, in cljs you would add something like this in your entry point:\n\n     ```\n     (ns ...\n       (:require\n         [com.fulcrologic.fulcro.react.error-boundaries :as eb]))\n\n     ...\n\n     (defn start []\n       (set! eb/*render-error*\n         (fn [this cause]\n           (dom/div\n             (dom/h2 :.header \\\" Unexpected Error \\\")\n             (dom/p \\\"An error occurred while rendering the user interface. \\\")\n             (dom/p (str cause))\n             (when #?(:clj false :cljs goog.DEBUG)\n               (dom/button {:onClick (fn []\n                                       (comp/set-state! this {:error false\n                                                              :cause nil}))} \\\" Dev Mode: Retry rendering \\\"))))))\n     ```\n     \"\n     [& body]\n     (if (enc/compiling-cljs?)\n       (error-boundary* body)\n       (error-boundary-clj body))))\n"]}